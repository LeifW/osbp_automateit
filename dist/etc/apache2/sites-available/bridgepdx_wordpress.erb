# +---------------------------------------------------------------------+
# | WARNING: Do NOT edit this file directly or your changes will be     |
# | lost. If you need to change this file, you must incorporate your    |
# | changes into the AutomateIt project that created it. If you don't   |
# | know what this means, please talk to your system administrator.     |
# +---------------------------------------------------------------------+

<VirtualHost *>
    # Site
    VirtualDocumentRoot /var/www/bridgepdx_wordpress
    ServerName bridgepdx.org
    ServerAlias www.bridgepdx.org bridgepdx bridgepdx.pragmaticraft.com opensourcebridge.org www.opensourcebridge.org

    # Common stylesheets and images
    Alias /common /var/www/bridgepdx_common

    # Logs
    ErrorLog /var/log/apache2/bridgepdx_wordpress.error.log
    TransferLog /var/log/apache2/bridgepdx_wordpress.access.log

    # Canonical hostname
    RewriteEngine on
    RewriteCond %{HTTP_HOST} !^opensourcebridge.org [NC]
    RewriteCond %{HTTP_HOST} !^$
    RewriteRule ^/(.*) http://opensourcebridge.org/$1 [L,R]

    # Proxy
    ProxyRequests off
    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>

    # OCW
    # FIXME session?
    # FIXME json/xml/csv?
<% for frag in %w[
admin
comments
events
images
javascripts
login
logout
manage
proposals
session
sessions
stylesheets
themes
users
] %>
    ProxyPassMatch ^(/<%= frag %>\..*)$  http://ocw.opensourcebridge.org$1
    ProxyPass /<%= frag %>  http://ocw.opensourcebridge.org/<%= frag %>
    <Location /<%= frag %>>
      ProxyPassReverse http://ocw.opensourcebridge.org/<%= frag %>
    </Location>
<% end %>
</VirtualHost>
